{% extends "layout2.html" %}
{% load i18n %}
{% load staticfiles %}

{% block css_include %}


{% endblock %}

{% block js_include %}
  <script src="{% static 'js/listener.js' %}"></script>
{% endblock %}


{% block content %}

  <section class="content">
    <form id="frontend_edit_form" class="form-horizontal bootstrap-validator-form" action="{% url 'services.frontend.edit' object_id %}" method="post" novalidate="novalidate">
      {% csrf_token %}
      <div class="row">
        <div class="col-md-12">
          {% if save_error or form.non_field_errors %}
          <div class="panel panel-danger">
            <div class="panel-heading">
              {# If there is save/configuration errors #}
              {% if save_error %}
                <ul class="nav nav-tabs pull-right ui-sortable-handle">
                  <li class="active"><a href="#tab_1" data-toggle="tab">{% trans "Message" %}</a></li>
                  <li><a href="#tab_2" data-toggle="tab">{% trans "Advanced informations" %}</a></li>
                </ul>
                <h4 class="panel-title">{% trans "Configuration error" %}</h4>
              {% endif %}
              {% if form.non_field_errors %}
                <h4 class="panel-title"><i class="icon fa fa-ban"></i> {% trans "Form errors" %} </h4>
              {% endif %}
            </div>
            <div class="panel-body">
              {# Print form errors correctly #}
              {% if form.non_field_errors %}
                <div>
                  {{ form.non_field_errors|safe }}
                </div>
              {% endif %}
              {# If there is save/configuration errors #}
              {% if save_error %}
                <div>
                  <div class="tab-content no-padding">
                    <div class="tab-pane active" id="tab_1">
                      <pre class="console-type">{{ save_error.0 }}</pre>
                    </div>
                    <div class="tab-pane" id="tab_2">
                      <pre class="console-type">{{ save_error.1 }}</pre>
                    </div>
                  </div>
                </div>
              {% endif %}
            </div>
          </div>
          {% endif %}
          <div class="panel">
            <div class="panel-body">
              <div class="nav-tabs-custom nav-tabs-no-margin">
                <ul class="nav nav-tabs">
                  <li class="active"><a href="#tab_general" data-toggle="tab">{% trans "General" %}</a></li>
                  <li><a href="#tab_network" data-toggle="tab" class="network-mode">{% trans "Listeners" %}</a></li>
                  <li><a href="#tab_api_client" data-toggle="tab" class="api-mode">{% trans "API Client" %}</a></li>
                  <li><a href="#tab_http" data-toggle="tab" class="http-mode">{% trans "HTTP Options" %}</a></li>
                  <li><a href="#tab_headers" data-toggle="tab" class="http-mode">{% trans "HTTP Headers" %}</a></li>
                  <li><a href="#tab_enrichment" data-toggle="tab" class="logging">{% trans "Logs Enrichment" %}</a></li>
                  <li><a href="#tab_logging" data-toggle="tab" class="logging">{% trans "Logs Forwarder" %}</a></li>
                  <li><a href="#tab_custom" data-toggle="tab" class="haproxy-conf">{% trans "Custom conf" %}</a></li>
                </ul>
                <div class="tab-content">
                  <br/>
                  <div class="tab-pane active" id="tab_general">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Enable listener" %}</label>
                          <div class="col-sm-5">
                            {{form.enabled}}
                            {{form.enabled.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row -->
                    <div class="row">
                      <div class="col-md-12">
                          <div class="form-group">
                            <label class="col-sm-4 control-label">{% trans "Friendly name" %}</label>
                            <div class="col-sm-5">
                              {{form.name}}
                              {{form.name.errors|safe}}
                            </div>
                          </div>
                      </div>
                    </div> <!-- /.row -->
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Mode" %}</label>
                          <div class="col-sm-5">
                            {{form.mode}}
                            {{form.mode.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row -->
                    <div class="row tcp-mode log-mode http-mode impcap-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Enable logging" %}</label>
                          <div class="col-sm-5">
                          {{form.enable_logging}}
                          {{form.enable_logging.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode http-mode -->
                    <div class="row http-mode-logging">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Log level" %}</label>
                          <div class="col-sm-5">
                            {{form.log_level}}
                            {{form.log_level.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode-logging -->
                    <div class="row http-mode-logging tcp-mode-logging">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Store logs into cluster database" %}</label>
                          <div class="col-sm-5">
                            <input type="checkbox" class="js-switch" id="stock_logs_locally"/>
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode-logging -->
                    <div class="row logging">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Archive logs on system" %}</label>
                          <div class="col-sm-5">
                            <input type="checkbox" class="js-switch" id="archive_logs"/>
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode-logging -->
                    <div class="row log-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Listening mode" %}</label>
                          <div class="col-sm-5">
                            {{form.listening_mode}}
                            {{form.listening_mode.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row log-mode" id="ruleset-div">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Input logs type" %}</label>
                          <div class="col-sm-5">
                            {{form.ruleset}}
                            {{form.ruleset.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row log-mode forwarder-tag">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.parser_tag.label }}</label>
                          <div class="col-sm-5">
                            {{form.parser_tag}}
                            {{form.parser_tag.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row log-mode file-mode kafka-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.node.label }}</label>
                          <div class="col-sm-5">
                            {{form.node}}
                            {{form.node.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row log-mode file-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.file_path.label }}</label>
                          <div class="col-sm-5">
                            {{form.file_path}}
                            {{form.file_path.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row log-mode kafka-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.kafka_brokers.label }}</label>
                          <div class="col-sm-5">
                            {{form.kafka_brokers}}
                            {{form.kafka_brokers.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row log-mode kafka-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.kafka_topic.label }}</label>
                          <div class="col-sm-5">
                            {{form.kafka_topic}}
                            {{form.kafka_topic.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row log-mode kafka-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.kafka_consumer_group.label }}</label>
                          <div class="col-sm-5">
                            {{form.kafka_consumer_group}}
                            {{form.kafka_consumer_group.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row log-mode listening-tcp">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Disable 'Octet-counted framing' (advanced) :" %}</label>
                          <div class="col-sm-5">
                            {{form.disable_octet_counting_framing}}
                            {{form.disable_octet_counting_framing.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Tags" %}</label>
                          <div class="col-sm-5">
                            {{form.tags}}
                            {{form.tags.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row -->
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Darwin policies" %}</label>
                          <div class="col-sm-5">
                            {{form.darwin_policies}}
                            {{form.darwin_policies.errors|safe}}
                          </div>
                        </div>
                      </div>
                      <div class="darwin-mode">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label class="col-sm-4 control-label">{% trans "Darwin mode" %}</label>
                            <div class="col-sm-5">
                              {{form.darwin_mode}}
                              {{form.darwin_mode.errors|safe}}
                            </div>
                          </div>
                        </div>
                      </div> <!-- /.row darwin-mode -->
                    </div> <!-- /.row -->
                  </div> <!-- /.tab-pane -->
                  <div class="tab-pane" id="tab_network">

                    <div class="panel-heading">
                      <div class="panel-control">
                        <a class="btn btn-flat btn-primary" id="add_listener"><i class="fa fa-plus-circle">&nbsp;</i>Add an entry</a>
                      </div>
                    </div>
                    <div class="row http-mode log-mode tcp-mode">
                      <div class="col-md-12">
                        <table id="listener_table" class="table table-striped table-bordered table-hover dt-responsive nowrap table-datatable">
                          <!-- Here are the attributes of Listener class -->
                          <thead>
                            <tr>
                              <th style="visibility:hidden;">Id</th>
                              <th>{% trans "Listen Address(es)" %}</th>
                              <th>{% trans "Port" %}</th>
                              <th>{% trans "TLS Profile" %}</th>
                              <th>{% trans "Allow from" %}</th>
                              <th>{% trans "Max src" %}</th>
                              <th>{% trans "Max rate" %}</th>
                              <th>{% trans "Delete" %}</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for l in listeners %}
                              {{ l.as_table_td|safe }}
                            {% endfor %}
                          </tbody>
                        </table>
                        {{ form.listeners.errors|safe }}
                        <input id="listeners" name="listeners" value="" type="hidden">
                      </div>
                    </div>
                    <div class="row impcap-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.impcap_intf.label }}</label>
                          <div class="col-sm-5">
                            {{form.impcap_intf}}
                            {{form.impcap_intf.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row impcap-mode -->
                    <div class="row impcap-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.impcap_filter_type.label }}</label>
                          <div class="col-sm-5">
                            {{form.impcap_filter_type}}
                            {{form.impcap_filter_type.errors|safe}}
                          </div>
                        </div>
                      </div> <!-- col-md-12 -->
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{ form.impcap_filter.label }}</label>
                          <div class="col-sm-5">
                            {{form.impcap_filter}}
                            {{form.impcap_filter.errors|safe}}
                          </div>
                        </div>
                      </div> <!-- col-md-12 -->
                    </div> <!-- /.row impcap-mode -->
                  <fieldset class="col-lg-12 sol-sm-12 haproxy-conf">
                      <legend>{% trans "Timeout options" %}</legend>
                      <div class="row haproxy-conf">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label class="col-sm-4 control-label">{% trans "Timeout connect" %}</label>
                            <div class="col-sm-5">
                              {{form.timeout_connect}}
                              {{form.timeout_connect.errors|safe}}
                            </div>
                            <div class="col-sm-2">
                              {% trans " ms" %}
                            </div>
                          </div>
                        </div>
                      </div> <!-- /.row -->
                      <div class="row tcp-mode haproxy-conf">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label class="col-sm-4 control-label">{% trans "Timeout client" %}</label>
                            <div class="col-sm-5">
                              {{form.timeout_client}}
                              {{form.timeout_client.errors|safe}}
                            </div>
                            <div class="col-sm-2">
                              {% trans " s" %}
                            </div>
                          </div>
                        </div>
                      </div> <!-- /.row -->
                      <div class="row http-mode">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label class="col-sm-4 control-label">{{form.timeout_keep_alive.label}}</label>
                            <div class="col-sm-5">
                              {{form.timeout_keep_alive}}
                              {{form.timeout_keep_alive.errors|safe}}
                            </div>
                            <div class="col-sm-2">
                              {% trans " ms" %}
                            </div>
                          </div>
                        </div>
                      </div> <!-- /.row -->
                    </fieldset>
                  </div>
                  <div class="tab-pane" id="tab_http">
                    <div class="row http-mode">
                     <div class="col-md-12">
                      <div class="form-group">
                        <label class="col-sm-4 control-label">{{form.https_redirect.label}}</label>
                        <div class="col-md-5">
                          {{form.https_redirect}}
                          {{form.https_redirect.errors|safe}}
                        </div>
                      </div>
                     </div>
                    </div>
                    <div class="row http-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Enable cache" %}</label>
                          <div class="col-sm-5">
                            {{form.enable_cache}}
                            {{form.enable_cache.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode -->
                    <div class="row http-mode cache">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Cache total max size (Mb)" %}</label>
                          <div class="col-sm-5">
                            {{form.cache_total_max_size}}
                            {{form.cache_total_max_size.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode cache -->
                    <div class="row http-mode cache">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Cache max age (seconds)" %}</label>
                          <div class="col-sm-5">
                            {{form.cache_max_age}}
                            {{form.cache_max_age.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode cache -->
                    <div class="row http-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Enable compression" %}</label>
                          <div class="col-sm-5">
                            {{form.enable_compression}}
                            {{form.enable_compression.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode -->
                    <div class="row http-mode compression">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Supported compression algorithms" %}</label>
                          <div class="col-sm-5">
                            {{form.compression_algos}}
                            {{form.compression_algos.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode compression -->
                    <div class="row http-mode compression">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "MIME types compressed" %}</label>
                          <div class="col-sm-5">
                            {{form.compression_mime_types}}
                            {{form.compression_mime_types.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode compression -->
                    <div class="row http-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Error template" %}</label>
                          <div class="col-sm-5">
                            {{form.error_template}}
                            {{form.error_template.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row http-mode -->
                  </div> <!-- /.tab-pane tab_http -->
                  <div class="tab-pane" id="tab_headers">
                    <div class="row http-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Headers" %}</label>
                        </div>
                        <table id="header_table" class="table table-striped table-bordered table-hover dt-responsive nowrap table-datatable">
                          <thead>
                            <tr>
                              <th style="visibility:hidden;">Id</th>
                              <th>{% trans "Type" %}</th>
                              <th>{% trans "Action" %}</th>
                              <th>{% trans "Name" %}</th>
                              <th>{% trans "Match" %}</th>
                              <th>{% trans "Replace" %}</th>
                              <th>{% trans "Condition type" %}</th>
                              <th>{% trans "Condition" %}</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for h in headers %}
                              {{ h.as_table_td|safe }}
                            {% endfor %}
                          </tbody>
                        </table>
                        <div style="text-align:right;margin-top:10px;">
                          <div class="add-group">
                            <button class="addplus addlink" id="add_header" type="button">{% trans "Add an Entry" %}</button>
                          </div>
                        </div>
                        {{ form.headers.errors|safe }}
                        <input id="headers" name="headers" value="" type="hidden">
                      </div>
                    </div>
                  </div> <!-- /.tab-pane tab_headers -->
                  <div class="tab-pane" id="tab_logging">
                    <div class="row logging">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{form.log_forwarders.label}}</label>
                          <div class="col-sm-5">
                            {{form.log_forwarders}}
                            {{form.log_forwarders.errors|safe}}
                          </div>
                        </div>
                      </div>
                      <div class="col-md-12 log-failure">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{{form.log_forwarders_parse_failure.label}}</label>
                          <div class="col-sm-5">
                            {{form.log_forwarders_parse_failure}}
                            {{form.log_forwarders_parse_failure.errors|safe}}
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-4 pull-right">
                        <div class="form-group">
                          <button class="btn btn-box-tool" type="button" data-toggle="collapse" data-target=".browsers-compat">
                            <i class="fa fa-plus"></i> {% trans "Advanced" %}
                          </button>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row logging">
                      <div class="col-md-12 log-parser-json">
                        <div class="form-group collapse browsers-compat">
                          <legend>{% trans "Rename fields (only on json source)" %}</legend>
                          <table id="keep_source_fields_table" class="table table-striped table-bordered table-hover dt-responsive nowrap table-datatable">
                            <!-- Here are the attributes of Listener class -->
                            <thead>
                              <tr>
                                <th>{% trans "Origin field" %}</th>
                                <th>{% trans "New field" %}</th>
                                <th>{% trans "Keep source" %}</th>
                                <th>{% trans "Delete" %}</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for key,val in form.keep_source_fields.initial.items %}
                                <tr>
                                  <td><input type="text" value="{{ val.field_name }}"/></td>
                                  <td><input type="text" value="{{ key }}"/></td>
                                  <td style="text-align:center"><input type="checkbox" {% if val.keep_source %}checked{% endif %}/></td>
                                  <td style="text-align:center"><a class="btnDelete"><i style="color:grey" class="fas fa-trash-alt"></i></a></td>
                                </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                          {{ form.keep_source_fields.errors|safe }}
                          <a class="btn btn-flat btn-primary" id="add_keep_source_field"><i class="fa fa-plus-circle">&nbsp;</i>Add an entry</a>
                          <input id="keep_source_fields" name="keep_source_fields" value="{{form.keep_source_fields.initial}}" type="hidden">
                        </div>
                      </div>
                    </div>
                    <div class="row logging">
                      <div class="col-md-12">
                        <div class="form-group collapse browsers-compat">
                          <table id="log_forwarders_table" class="table table-striped table-bordered table-hover dt-responsive nowrap table-datatable">
                            <thead>
                              {{ log_om_table.as_table_headers|safe }}
                            </thead>
                            <tbody>
                            {{ log_om_table.as_table_td|safe }}
                            </tbody>
                          </table>
                          <div style="text-align:right;margin-top:10px;">
                            <div class="add-group">
                              <button class="addplus addlink" id="add_log_fwd_entry" data-id="request_data_get" type="button">{% trans "Add an Entry" %}</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row logging">
                      <div class="col-md-12">
                        <div class="form-group collapse browsers-compat">
                          <label class="col-sm-4 control-label">{% trans "Logging conditions" %}</label>
                          <div class="col-sm-5">
                            {{form.log_condition}}
                            {{form.log_condition.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div> <!-- /.tab-pane tab_logging -->
                  <div class="tab-pane" id="tab_enrichment">
                    <div class="row logging http-mode-logging">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Tenants config" %}</label>
                          <div class="col-sm-5">
                            {{form.tenants_config}}
                            {{form.tenants_config.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row logging http-mode-logging">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Enable reputation logging" %}</label>
                          <div class="col-sm-5">
                            {{form.enable_logging_reputation}}
                            {{form.enable_logging_reputation.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row reputation-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Reputation database IPv4" %}</label>
                          <div class="col-sm-5">
                            {{form.logging_reputation_database_v4}}
                            {{form.logging_reputation_database_v4.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row reputation-mode">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Reputation database IPv6" %}</label>
                          <div class="col-sm-5">
                            {{form.logging_reputation_database_v6}}
                            {{form.logging_reputation_database_v6.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row logging http-mode-logging">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-4 control-label">{% trans "Geoip database (v4 & v6)" %}</label>
                          <div class="col-sm-5">
                            {{form.logging_geoip_database}}
                            {{form.logging_geoip_database.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div> <!-- /.row log-mode -->
                    <div class="row logging">
                      {% if not reputationctx_form.reputation_ctx.field.choices %}
                        <a class="btn btn-flat btn-primary" href="{% url 'applications.reputation_ctx.edit' %}">
                          <i class="fa fa-plus-circle">&nbsp;
                          </i>
                          {% trans "No custom tags for now, create a new <b>Custom tags</b> object." %}
                        </a>
                      {% else %}
                        <div class="col-md-12">
                          <div class="form-group">
                            <table id="reputationctx_table" class="table table-striped table-bordered table-hover dt-responsive nowrap table-datatable">
                              <thead>
                                {{ reputationctx_form.as_table_headers|safe }}
                              </thead>
                              <tbody>
                              {% for reputationctx in reputation_contexts %}
                                {{ reputationctx.as_table_td|safe }}
                              {% endfor %}
                              </tbody>
                            </table>
                            <div style="text-align:right;margin-top:10px;">
                              <div class="add-group">
                                <button class="addplus addlink" id="add_reputationctx_entry" data-id="request_data_get" type="button">{% trans "Add an Entry" %}</button>
                              </div>
                            </div>
                            {{ form.reputation_ctx.errors|safe }}
                            <input id="reputation_contexts" name="reputation_contexts" value="" type="hidden">
                          </div>
                        </div>
                      {% endif %}
                    </div>
                  </div>
                  <div class="tab-pane" id="tab_custom">
                    <div class="row haproxy-conf">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{% trans "HAProxy Frontend Config" %}</label>
                          <div class="col-sm-8">
                            {{form.custom_haproxy_conf}}
                            {{form.custom_haproxy_conf.errors|safe}}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div> <!-- /.tab-pane tab_custom -->

                  <div class="tab-pane" id="tab_api_client">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{% trans "API Parser Type" %}</label>
                          <div class="col-sm-5">
                            {{ form.api_parser_type }}
                            {{ form.api_parser_type.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{% trans "Use proxy" %}</label>
                          <div class="col-sm-5">
                            {{ form.api_parser_use_proxy }}
                            {{ form.api_parser_use_proxy.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_office_365_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.office365_tenant_id.label }}</label>
                          <div class="col-sm-5">
                            {{ form.office365_tenant_id }}
                            {{ form.office365_tenant_id.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.office365_client_id.label }}</label>
                          <div class="col-sm-5">
                            {{ form.office365_client_id }}
                            {{ form.office365_client_id.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.office365_client_secret.label }}</label>
                          <div class="col-sm-5">
                            {{ form.office365_client_secret }}
                            {{ form.office365_client_secret.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_akamai_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.akamai_host.label }}</label>
                          <div class="col-sm-5">
                            {{ form.akamai_host }}
                            {{ form.akamai_host.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.akamai_config_id.label }}</label>
                          <div class="col-sm-5">
                            {{ form.akamai_config_id }}
                            {{ form.akamai_config_id.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.akamai_client_secret.label }}</label>
                          <div class="col-sm-5">
                            {{ form.akamai_client_secret }}
                            {{ form.akamai_client_secret.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.akamai_access_token.label }}</label>
                          <div class="col-sm-5">
                            {{ form.akamai_access_token }}
                            {{ form.akamai_access_token.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.akamai_client_token.label }}</label>
                          <div class="col-sm-5">
                            {{ form.akamai_client_token }}
                            {{ form.akamai_client_token.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_forcepoint_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.forcepoint_host.label }}</label>
                          <div class="col-sm-5">
                            {{ form.forcepoint_host }}
                            {{ form.forcepoint_host.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.forcepoint_username.label }}</label>
                          <div class="col-sm-5">
                            {{ form.forcepoint_username }}
                            {{ form.forcepoint_username.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.forcepoint_password.label }}</label>
                          <div class="col-sm-5">
                            {{ form.forcepoint_password }}
                            {{ form.forcepoint_password.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_imperva_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.imperva_base_url.label }}</label>
                          <div class="col-sm-5">
                            {{ form.imperva_base_url }}
                            {{ form.imperva_base_url.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.imperva_api_key.label }}</label>
                          <div class="col-sm-5">
                            {{ form.imperva_api_key }}
                            {{ form.imperva_api_key.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.imperva_api_id.label }}</label>
                          <div class="col-sm-5">
                            {{ form.imperva_api_id }}
                            {{ form.imperva_api_id.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.imperva_private_key.label }}</label>
                          <div class="col-sm-5">
                            {{ form.imperva_private_key }}
                            {{ form.imperva_private_key.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_elasticsearch_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.elasticsearch_host.label }}</label>
                          <div class="col-sm-5">
                            {{ form.elasticsearch_host }}
                            {{ form.elasticsearch_host.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.elasticsearch_verify_ssl.label }}</label>
                          <div class="col-sm-5">
                            {{ form.elasticsearch_verify_ssl }}
                            {{ form.elasticsearch_verify_ssl.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.elasticsearch_auth.label }}</label>
                          <div class="col-sm-5">
                            {{ form.elasticsearch_auth }}
                            {{ form.elasticsearch_auth.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group elasticsearch_auth">
                          <label class="col-sm-3 control-label">{{ form.elasticsearch_username.label }}</label>
                          <div class="col-sm-5">
                            {{ form.elasticsearch_username }}
                            {{ form.elasticsearch_username.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group elasticsearch_auth">
                          <label class="col-sm-3 control-label">{{ form.elasticsearch_password.label }}</label>
                          <div class="col-sm-5">
                            {{ form.elasticsearch_password }}
                            {{ form.elasticsearch_password.errors|safe }}
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.elasticsearch_index.label }}</label>
                          <div class="col-sm-5">
                            {{ form.elasticsearch_index }}
                            {{ form.elasticsearch_index.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_symantec_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.symantec_username.label }}</label>
                          <div class="col-sm-5">
                            {{ form.symantec_username }}
                            {{ form.symantec_username.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.symantec_password.label }}</label>
                          <div class="col-sm-5">
                            {{ form.symantec_password }}
                            {{ form.symantec_password.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_reachfive_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.reachfive_host.label }}</label>
                          <div class="col-sm-5">
                            {{ form.reachfive_host }}
                            {{ form.reachfive_host.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.reachfive_client_id.label }}</label>
                          <div class="col-sm-5">
                            {{ form.reachfive_client_id }}
                            {{ form.reachfive_client_id.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.reachfive_client_secret.label }}</label>
                          <div class="col-sm-5">
                            {{ form.reachfive_client_secret }}
                            {{ form.reachfive_client_secret.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_mongodb_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.mongodb_api_user.label }}</label>
                          <div class="col-sm-5">
                            {{ form.mongodb_api_user }}
                            {{ form.mongodb_api_user.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.mongodb_api_password.label }}</label>
                          <div class="col-sm-5">
                            {{ form.mongodb_api_password }}
                            {{ form.mongodb_api_password.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.mongodb_api_group_id.label }}</label>
                          <div class="col-sm-5">
                            {{ form.mongodb_api_group_id }}
                            {{ form.mongodb_api_group_id.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_defender_atp_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.mdatp_api_tenant.label }}</label>
                          <div class="col-sm-5">
                            {{ form.mdatp_api_tenant }}
                            {{ form.mdatp_api_tenant.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.mdatp_api_appid.label }}</label>
                          <div class="col-sm-5">
                            {{ form.mdatp_api_appid }}
                            {{ form.mdatp_api_appid.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.mdatp_api_secret.label }}</label>
                          <div class="col-sm-5">
                            {{ form.mdatp_api_secret }}
                            {{ form.mdatp_api_secret.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_cortex_xdr_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.cortex_xdr_host.label }}</label>
                          <div class="col-sm-5">
                            {{ form.cortex_xdr_host }}
                            {{ form.cortex_xdr_host.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.cortex_xdr_apikey_id.label }}</label>
                          <div class="col-sm-5">
                            {{ form.cortex_xdr_apikey_id }}
                            {{ form.cortex_xdr_apikey_id.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.cortex_xdr_apikey.label }}</label>
                          <div class="col-sm-5">
                            {{ form.cortex_xdr_apikey }}
                            {{ form.cortex_xdr_apikey.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_cisco_meraki_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.cisco_meraki_apikey.label }}</label>
                          <div class="col-sm-5">
                            {{ form.cisco_meraki_apikey }}
                            {{ form.cisco_meraki_apikey.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_cybereason_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.cybereason_host.label }}</label>
                          <div class="col-sm-5">
                            {{ form.cybereason_host }}
                            {{ form.cybereason_host.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.cybereason_username.label }}</label>
                          <div class="col-sm-5">
                            {{ form.cybereason_username }}
                            {{ form.cybereason_username.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.cybereason_password.label }}</label>
                          <div class="col-sm-5">
                            {{ form.cybereason_password }}
                            {{ form.cybereason_password.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_aws_bucket_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.aws_access_key_id.label }}</label>
                          <div class="col-sm-5">
                            {{ form.aws_access_key_id }}
                            {{ form.aws_access_key_id.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.aws_secret_access_key.label }}</label>
                          <div class="col-sm-5">
                            {{ form.aws_secret_access_key }}
                            {{ form.aws_secret_access_key.errors|safe }}
                          </div>
                        </div>

                        <div class="text-center mar-btm">
                          <button class="btn btn-primary fetch_data_api_parser" data-target="id_aws_bucket_name" data-type="select" type="button">
                            {% trans "Fetch buckets name" %}
                          </button>
                        </div>

                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.aws_bucket_name.label }}</label>
                          <div class="col-sm-5">
                            {{ form.aws_bucket_name }}
                            {{ form.aws_bucket_name.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12 api_clients_row" id="api_proofpoint_tap_row">
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.proofpoint_tap_host.label }}</label>
                          <div class="col-sm-5">
                            {{ form.proofpoint_tap_host }}
                            {{ form.proofpoint_tap_host.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.proofpoint_tap_endpoint.label }}</label>
                          <div class="col-sm-5">
                            {{ form.proofpoint_tap_endpoint }}
                            {{ form.proofpoint_tap_endpoint.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.proofpoint_tap_principal.label }}</label>
                          <div class="col-sm-5">
                            {{ form.proofpoint_tap_principal }}
                            {{ form.proofpoint_tap_principal.errors|safe }}
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-3 control-label">{{ form.proofpoint_tap_secret.label }}</label>
                          <div class="col-sm-5">
                            {{ form.proofpoint_tap_secret }}
                            {{ form.proofpoint_tap_secret.errors|safe }}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12">
                        <div class="text-center mar-btm">
                          <button class="btn btn-warning" id="test_api_parser" type="button">
                            {% trans "Test Configuration" %}
                          </button>
                          <input type="hidden" name="api_parser_has_been_tested" id="id_api_parser_has_been_tested" value="{% if object_id %}1{% else %}0{% endif %}"/>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel-footer">
              <a type="button" href="{% url 'services.frontend.list' %}" class="btn btn-flat btn-default">{% trans "Cancel" %}</a>
              <button type="submit" class="btn btn-info btn-flat pull-right">{% trans "Submit" %}</button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </section>

  <div class="modal" id="modal-test-apiparser">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal"><i class="pci-cross pci-circle"></i></button>
                  <h4 class="modal-title">{% trans "API Parser results" %}</h4>
              </div>

              <div class="modal-body" id="modal-test-apiparser-body">

              </div>

              <div class="modal-footer">
                  <button class="btn btn-primary" data-dismiss="modal" type="button">{% trans "Continue" %}</button>
              </div>
          </div>
      </div>
  </div>

{% endblock %}

{% block jquery_code %}
  {% if save_error %}
    notify('error', '{% trans "Error" %}', '{{ save_error.0 }}');
  {% endif %}

  {% if errors %}
    notify('error', '{% trans "Error" %}', '{{ errors }}');
  {% endif %}

  var header_form_td = `{{header_form.as_table_td|safe}}`
  var listener_form_td = `{{listener_form.as_table_td|safe}}`;
  var log_om_table_td = `{{log_om_table.as_table_td|safe}}`;
  var reputationctx_form_td = `{{reputationctx_form.as_table_td|safe}}`;
  var redis_forwarder = "{{redis_forwarder}}";
  var redis_forwarder_added = false;
  var old_mode = $('id_mode').val();

  var test_frontend_apiparser_uri = "{% url 'services.frontend.test_apiparser' %}";
  var fetch_frontend_api_parser_data_uri = "{% url 'services.frontend.fetch_apiparser_data' %}";

{% endblock %}
